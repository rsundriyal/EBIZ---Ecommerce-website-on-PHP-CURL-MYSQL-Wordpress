!function(t,s,e,i){function n(){this.opts=t.extend({},o),this.premium=t.extend({},c)}var a="ylc",r="plugin_"+a,o={app_id:"",render:!0,display_login:!0,user_info:{user_id:null,user_name:null,user_email:null,gravatar:null,user_type:null,avatar_type:null,avatar_image:null,current_page:null,user_ip:null},styles:{bg_color:"#009EDB",x_pos:"right",y_pos:"bottom",border_radius:"5px 5px 0 0",popup_width:370,btn_width:260,form_width:260,animation_type:"bounceIn",autoplay:!0,autoplay_delay:1e3}},l=null,c={};n.prototype={init:function(s,e){t.extend(this.opts,s),this.data={auth:null,ref:null,is_mobile:!1,active_user_id:0,mode:"offline",logged:!1,assets_url:ylc.plugin_url,animation_delay:1e3,show_delay:1e3,guest_prefix:"Guest-",primary_fg:null,primary_hover:null,popup_status:"close",user:{},current_form:{},online_ops:{}},this.strings={months:[ylc.strings.months.jan,ylc.strings.months.feb,ylc.strings.months.mar,ylc.strings.months.apr,ylc.strings.months.may,ylc.strings.months.jun,ylc.strings.months.jul,ylc.strings.months.aug,ylc.strings.months.sep,ylc.strings.months.oct,ylc.strings.months.nov,ylc.strings.months.dec],months_short:[ylc.strings.months_short.jan,ylc.strings.months_short.feb,ylc.strings.months_short.mar,ylc.strings.months_short.apr,ylc.strings.months_short.may,ylc.strings.months_short.jun,ylc.strings.months_short.jul,ylc.strings.months_short.aug,ylc.strings.months_short.sep,ylc.strings.months_short.oct,ylc.strings.months_short.nov,ylc.strings.months_short.dec],time:{suffix:ylc.strings.time.suffix,seconds:ylc.strings.time.seconds,minute:ylc.strings.time.minute,minutes:ylc.strings.time.minutes,hour:ylc.strings.time.hour,hours:ylc.strings.time.hours,day:ylc.strings.time.day,days:ylc.strings.time.days,month:ylc.strings.time.month,months:ylc.strings.time.months,year:ylc.strings.time.year,years:ylc.strings.time.years},fields:{name:ylc.strings.fields.name,name_ph:ylc.strings.fields.name_ph,email:ylc.strings.fields.email,email_ph:ylc.strings.fields.email_ph,message:ylc.strings.fields.message,message_ph:ylc.strings.fields.message_ph},msg:{chat_title:ylc.strings.msg.chat_title,prechat_msg:ylc.strings.msg.prechat_msg,welc_msg:ylc.strings.msg.welc_msg,start_chat:ylc.strings.msg.start_chat,offline_body:ylc.strings.msg.offline_body,busy_body:ylc.strings.msg.busy_body,close_msg:ylc.strings.msg.close_msg,close_msg_user:ylc.strings.msg.close_msg_user,reply_ph:ylc.strings.msg.reply_ph,send_btn:ylc.strings.msg.send_btn,no_op:ylc.strings.msg.no_op,no_msg:ylc.strings.msg.no_msg,sending:ylc.strings.msg.sending,connecting:ylc.strings.msg.connecting,writing:ylc.strings.msg.writing,please_wait:ylc.strings.msg.please_wait,chat_online:ylc.strings.msg.chat_online,chat_offline:ylc.strings.msg.chat_offline,your_msg:ylc.strings.msg.your_msg,end_chat:ylc.strings.msg.end_chat,conn_err:ylc.strings.msg.conn_err,you:ylc.strings.msg.you,online_btn:ylc.strings.msg.online_btn,offline_btn:ylc.strings.msg.offline_btn,field_empty:ylc.strings.msg.field_empty,invalid_email:ylc.strings.msg.invalid_email,invalid_username:ylc.strings.msg.invalid_username,user_name:ylc.strings.msg.user_name,user_email:ylc.strings.msg.user_email,user_ip:ylc.strings.msg.user_ip,user_page:ylc.strings.msg.user_page,connect:ylc.strings.msg.connect,disconnect:ylc.strings.msg.disconnect,you_offline:ylc.strings.msg.you_offline,save_chat:ylc.strings.msg.save_chat,ntf_close_console:ylc.strings.msg.ntf_close_console,new_msg:ylc.strings.msg.new_msg,new_user_online:ylc.strings.msg.new_user_online,saving:ylc.strings.msg.saving,waiting_users:ylc.strings.msg.waiting_users,good:ylc.strings.msg.good,bad:ylc.strings.msg.bad,chat_evaluation:ylc.strings.msg.chat_evaluation,talking_label:ylc.strings.msg.talking_label,timer:ylc.strings.msg.timer,chat_copy:ylc.strings.msg.chat_copy,already_logged:ylc.strings.msg.already_logged}},ylc.is_premium&&t.extend(this.premium,e),this.objs={btn:null,popup:null,popup_header:null,cnv:null};var i=this;ylc.is_premium&&this.trigger_premium("logged_users_auth"),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(this.data.is_mobile=!0),this.post("ylc_ajax_callback","get_token",{},function(t){t.error||(i.data.auth_token=t.token,i.render_btn(),i.render_popup())})},auth:function(t){return this.opts.app_id?(null==this.data.ref&&(this.data.ref=new Firebase("https://"+this.opts.app_id+".firebaseIO.com"),this.data.ref_conn=new Firebase("https://"+this.opts.app_id+".firebaseIO.com/.info/connected"),this.data.ref_cnv=new Firebase("https://"+this.opts.app_id+".firebaseIO.com/chat_sessions"),this.data.ref_msgs=new Firebase("https://"+this.opts.app_id+".firebaseIO.com/chat_messages"),this.data.ref_users=new Firebase("https://"+this.opts.app_id+".firebaseIO.com/chat_users")),void(this.opts.display_login?this.login(!1,t):this.login(!0,t))):void console.error("App ID not provided")},login:function(s,e){var n=this;this.manage_connections(),this.data._new_user=s,this.data.auth=this.data.ref.authWithCustomToken(this.data.auth_token,function(s){s?(console.error(s.code,s.message),n.display_ntf(n.strings.msg.conn_err,"error")):(n.data.logged=!0,n.data.ref_users.once("value",function(s){var a=s.val(),r=0,o=!1,c=0,_=!1,h=!1;if(null!==a){var u=Object.keys(a).length;t.each(a,function(t,s){c++,s&&("operator"==s.user_type&&"online"===s.status?n.valid_operator(s.vendor_id)&&(n.data.online_ops[s.user_id]=s):"operator"!=s.user_type&&(s.user_name!==i&&s.user_id!=n.opts.user_info.user_id&&r++,s.user_email!==i&&n.data.current_form.user_email!==i&&(s.user_email!=n.data.current_form.user_email||ylc.frontend_op_access||(s.user_ip==n.opts.user_info.user_ip?"online"===s.status&&s.user_id!=n.opts.user_info.user_id?_=!0:h=s.conversation_id:_=!0)))),_?n.display_ntf(n.strings.msg.already_logged,"error"):c===u&&(n.total_online_ops()||h?"operator"==n.opts.user_info.user_type||r<ylc.max_guests||0==ylc.max_guests?(null!=l&&clearInterval(l),n.opts.display_login?n.show_login():n.show_cnv(!0)):(o=!0,n.show_offline(!0)):n.show_offline(),n.check_user(n.opts.user_info.user_id,o,h))})}else n.show_offline(),n.check_user(n.opts.user_info.user_id,!1);e&&e(o)}))})},logout:function(e){var i=this;this.data.user.user_id&&(i.data.ref_user.off(),i.data.ref_users.off(),i.data.ref_msgs.off()),i.objs.popup_body.css("width",i.opts.styles.form_width+"px").removeClass().addClass("chat-body chat-form").empty().html(i.get_template("chat-offline",{lead:i.strings.msg.close_msg,form:""})),ylc.is_premium?i.trigger_premium("end_chat_options",e):(e&&i.clear_user_data(i.data.user.conversation_id),setTimeout(function(){i.be_offline(),i.minimize()},2e3)),i.objs.popup_header.click(function(){i.minimize(),i.objs.popup_header.off("click")}),t(s).trigger("resize")},be_offline:function(){this.data.mode="offline",this.data.ref_user&&(this.data.ref_user.child("status").set("offline"),this.data.ref_user.child("last_online").set(Firebase.ServerValue.TIMESTAMP)),this.check_mode(!0)},check_mode:function(s){var e=this.data.mode;if(s)this.show_connecting(),this.data.mode="offline";else if(this.total_online_ops())"offline"===e&&(t("#YLC_cnv_reply").removeClass("chat-disabled").removeAttr("disabled"),this.clean_ntf()),this.data.mode=this.opts.display_login&&"online"!=e?"login":"online";else{switch(e){case"login":this.show_offline();break;case"online":ylc.is_premium||(this.opts.display_login?(t("#YLC_cnv_reply").addClass("chat-disabled").attr("disabled","disabled"),this.display_ntf(this.strings.msg.no_op+"!","error")):this.show_offline())}this.data.mode="offline"}},show_offline:function(e){var n=this;this.data.mode="offline",this.allow_chatbox()&&(n.objs.popup_header.find(".chat-title").html(n.strings.msg.chat_title),n.objs.popup.parent().removeClass().addClass("chat-offline"),n.objs.popup_body.css("width",this.opts.styles.form_width+"px").removeClass().addClass("chat-body chat-form").empty().html(n.get_template("chat-offline",{lead:e?n.strings.msg.busy_body:n.strings.msg.offline_body})),(!e||e&&ylc.show_busy_form)&&ylc.is_premium&&n.trigger_premium("show_offline_form"),t(s).trigger("resize"),e&&(null!=l&&clearInterval(l),l=setInterval(function(){n.data.ref_users.once("value",function(s){var e=s.val(),a=0;null!==e&&t.each(e,function(t,s){s&&s.user_name!==i&&"operator"!=s.user_type&&s.user_id!=n.opts.user_info.user_id&&a++}),a<ylc.max_guests&&(n.opts.display_login?n.login(!1):n.login(!0))})},3e4)))},show_connecting:function(){this.objs.popup_body.css("width",this.opts.styles.form_width+"px").html(this.get_template("chat-connecting",{lead:this.strings.msg.connecting+"..."}))},show_login:function(e,i){var n=this;this.allow_chatbox()&&(this.opts.display_login&&this.total_online_ops()&&this.objs.popup?(this.data.mode="login",this.objs.popup_header.find(".chat-title").html(this.strings.msg.chat_title),this.objs.popup.parent().removeClass().addClass("chat-login"),this.objs.popup_body.css("width",this.opts.styles.form_width+"px").removeClass().addClass("chat-body chat-form").empty().html(this.get_template("chat-login",{lead:e||this.strings.msg.prechat_msg,btn_text:this.strings.msg.start_chat,btn_styles:ylc.is_premium?this.trigger_premium("stylize","form_button"):"",field_name:this.strings.fields.name,name_ph:this.strings.fields.name_ph,field_email:this.strings.fields.email,email_ph:this.strings.fields.email_ph})),t(s).trigger("resize"),t("#YLC_login_btn").hover(function(){t(this).css("background-color",n.data.primary_hover)},function(){t(this).css("background-color",n.opts.styles.bg_color)}).click(function(){n.send_login_form()}),t("#YLC_popup_form").keydown(function(t){13!=t.keyCode||t.shiftKey||(t.preventDefault(),n.send_login_form())})):"online"===n.data.mode?this.show_cnv():this.show_offline(),i&&this.minimize())},send_login_form:function(){var s=this;this.display_ntf(this.strings.msg.connecting+"...","sending");var e=t("#YLC_popup_form").serializeArray(),i=e.length-1;t.each(e,function(t,e){if(s.data.current_form[e.name]=e.value,!e.value)return s.display_ntf(s.strings.msg.field_empty,"error"),!1;if("user_email"===e.name){if(!s.validate_email(e.value))return s.display_ntf(s.strings.msg.invalid_email,"error"),!1;s.data.current_form.gravatar=s.md5(e.value)}else if(!s.validate_username(e.value))return s.display_ntf(s.strings.msg.invalid_username,"error"),!1;t===i&&setTimeout(function(){s.login(!0)},1e4)})},check_user:function(t,s,e){var i=this;this.data.ref_user=this.data.ref_users.child(t),s?this.data.ref_user.child("status").set("wait"):(this.data.ref_user.once("value",function(s){var n=s.val();n||(n={}),i.get_user(t,n,e)}),this.data.ref_user.child("chat_with").on("value",function(t){var s=t.val();null!=s&&(i.data.user.chat_with=s)})),this.data.ref_users.on("child_removed",function(s){var e=s.val();e&&t===e.user_id&&i.logout()})},get_user:function(t,s,e,i){var n=this;if(s.user_id)this.data.user=s,this.data.ref_user.child("status").set("online"),this.data.ref_user.child("user_ip").set(n.opts.user_info.user_ip),this.data.ref_user.child("current_page").set(n.opts.user_info.current_page),this.data.ref_user.child("vendor_id").set(ylc.active_vendor.vendor_id),this.data.ref_user.child("vendor_name").set(ylc.active_vendor.vendor_name),this.data.ref_user.child("chat_with").set("free"),this.total_online_ops()?this.show_cnv():this.show_offline(),this.manage_connections(),n.listen_users(),i&&i();else if(this.data._new_user===!0){var a=this.data.ref_cnv.push({user_id:t,created_at:Firebase.ServerValue.TIMESTAMP,accepted_at:"",evaluation:"",user_type:"visitor",receive_copy:!1}),r={user_id:t,conversation_id:a.key(),last_online:"",is_mobile:this.data.is_mobile,chat_with:"free",status:"online",vendor_id:ylc.active_vendor.vendor_id,vendor_name:ylc.active_vendor.vendor_name};for(var o in this.opts.user_info)r[o]=this.opts.user_info[o];for(var l in this.data.current_form)r[l]=this.data.current_form[l];r.user_name||(r.user_email?r.user_name=r.user_email.substring(0,r.user_email.indexOf("@")):r.user_name=this.data.guest_prefix+this.random_id(1e3,5e3)),this.data.user=r,this.data.ref_user.set(r,function(t){if(!t&&(n.show_cnv(),n.manage_connections(),n.listen_users(),e))if(ylc.is_premium){var s=new Date;n.trigger_premium("save_user_data",e,!0,s.getTime(),!1)}else n.clear_user_data(e);i&&i()})}else n.listen_users()},show_cnv:function(e){var i=this;this.data.mode="online",this.allow_chatbox()&&(this.objs.popup_header.find(".chat-title").html(this.strings.msg.chat_title),this.objs.popup.parent().removeClass().addClass("chat-online"),this.objs.popup_body.css("width",this.opts.styles.popup_width+"px").removeClass().addClass("chat-body chat-online").empty().html(this.get_template("chat-conversation",{reply_ph:this.strings.msg.reply_ph,welc:this.strings.msg.welc_msg,end_chat:this.strings.msg.end_chat})),this.objs.cnv=t("#YLC_cnv"),e?setTimeout(function(){t("#YLC_cnv_reply").focus().autosize({append:""}).trigger("autosize.resize")},this.data.animation_delay):t("#YLC_cnv_reply").focus().autosize({append:""}).trigger("autosize.resize"),t(s).trigger("resize"),this.listen_msgs(),t("#YLC_tool_end_chat").click(function(){i.push_msg("-- "+i.strings.msg.close_msg_user+" --"),i.data.ref_cnv.child(i.data.user.conversation_id).child("status").set("closed"),i.logout(!0)}),this.manage_reply_box())},listen_users:function(){var s=this;this.data.last_changed_id=null,this.data.ref_users.once("value",function(e){var i=e.val(),n=0;if(null!==i){var a=Object.keys(i).length;s.data.online_ops={},t.each(i,function(t,e){n+=1,e&&s.valid_operator(e.vendor_id)&&"operator"===e.user_type&&("online"===e.status?s.data.online_ops[e.user_id]=e:delete s.data.online_ops[e.user_id]),n===a&&(s.check_mode(),s.listen_new_users())})}})},listen_new_users:function(s){var e=this;this.data.ref_users.on("value",function(s){var i=s.val();t.each(i,function(t,s){e.update_user(s)})})},update_user:function(t,s){(!t||t.user_id)&&(t&&(t.conversation_id?("operator"===t.user_type&&("online"===t.status?this.data.online_ops[t.user_id]=t:delete this.data.online_ops[t.user_id]),this.check_mode()):this.clean_user_data(t.user_id)),this.data.last_changed_id=s)},clean_user_data:function(s){var e=this,i=this.data.ref_users.child(s);i.once("value",function(n){var a=n.val();i.remove(),a.conversation_id&&e.ref_cnv.child(a.conversation_id),e.data.ref_msgs.once("value",function(i){var n=i.val();n&&t.each(n,function(t,i){i.user_id===s&&e.data.ref_msgs.child(t).remove()})})})},set_avatar:function(t,s){return t="operator"==t?"admin":"user",ylc.is_premium?this.trigger_premium("set_avatar_premium",t,s):this.data.assets_url+"/images/default-avatar-"+t+".png"},time:function(t,s){return this.strings.time[t]&&this.strings.time[t].replace(/%d/i,Math.abs(Math.round(s)))},timeago:function(t){if(!t)return"";var s=new Date,e=.001*(s.getTime()-t)>>0,i=e/60,n=i/60,a=n/24,r=a/365;return(45>e&&this.time("seconds",e)||90>e&&this.time("minute",1)||45>i&&this.time("minutes",i)||90>i&&this.time("hour",1)||24>n&&this.time("hours",n)||42>n&&this.time("day",1)||30>a&&this.time("days",a)||45>a&&this.time("month",1)||365>a&&this.time("months",a/30)||1.5>r&&this.time("year",1)||this.time("years",r))+" "+this.strings.time.suffix},listen_msgs:function(){var s=this;this.data.ref_msgs.off(),this.data.ref_msgs.once("value",function(e){var i=e.val(),n=i?Object.keys(i).length:0,a=1;i?t.each(i,function(t,e){s.data.user.conversation_id==e.conversation_id&&(e.id=t,s.add_msg(e)),e.first_load=!0,n==a&&s.listen_new_msgs(t),a+=1}):s.listen_new_msgs()})},listen_new_msgs:function(t){var s=this,e=t?s.data.ref_msgs.startAt(null,t):s.data.ref_msgs,i=!0;t||(i=!1),e.on("child_added",function(t){var e=t.val();e.id=t.key(),s.data.user.conversation_id==e.conversation_id&&(i||s.add_msg(e)),i||s.show_popup(),i=!1})},add_msg:function(t,s,e){var i=new Date,n=new Date(t.msg_time),a=n.getHours()+":"+(n.getMinutes()<10?"0":"")+n.getMinutes(),r=this.sanitize_msg(t.msg),o=n.toDateString()==i.toDateString()?a:n.getUTCDate()+" "+this.strings.months_short[n.getUTCMonth()]+", "+a;this.objs.cnv.find(".chat-welc").hide(),this.objs.cnv&&this.objs.cnv.append(this.get_template("chat-line",{msg_id:t.id,time:o,date:n.getUTCDate()+" "+this.strings.months[n.getUTCMonth()]+" "+n.getUTCFullYear()+" "+a,color:"transparent",avatar:this.set_avatar(t.user_type,{gravatar:t.gravatar,avatar_type:t.avatar_type,avatar_image:t.avatar_image}),name:t.user_name,msg:r,"class":t.user_id==this.data.user.user_id?" chat-you":""})).scrollTop(this.objs.cnv.prop("scrollHeight"))},sanitize_msg:function(t){var s,e,i,n,a,r={"&":"&amp;","<":"&lt;",">":"&gt;"};return s=t.replace(/[&<>]/g,function(t){return r[t]||t}),a=/\n/gim,s=s.replace(a,"<br />"),e=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,s=s.replace(e,'<a href="$1" target="_blank">$1</a>'),i=/(^|[^\/])(www\.[\S]+(\b|$))/gim,s=s.replace(i,'$1<a href="http://$2" target="_blank">$2</a>'),n=/(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim,s=s.replace(n,'<a href="mailto:$1">$1</a>')},manage_reply_box:function(s){var e=this,i=!1,n=t("#YLC_cnv_reply"),a=function(){var t=0;return function(s,e){clearTimeout(t),t=setTimeout(s,e)}}();this.data.ref_cnv.child(this.data.user.conversation_id+"/typing").remove(),n.keydown(function(s){if(13!==s.keyCode||s.shiftKey){if(!i){switch(s.keyCode){case 17:case 18:case 16:case 9:case 8:case 224:case 17:case 91:case 93:return}e.data.ref_cnv.child(e.data.user.conversation_id+"/typing/"+e.data.user.user_id).set(e.data.user.user_name),i=!0}a(function(){e.data.ref_cnv.child(e.data.user.conversation_id+"/typing/"+e.data.user.user_id).remove(),i=!1},1300)}else{s.preventDefault();var n=t(this).val();n&&(t(this).val("").trigger("autosize.resize"),e.push_msg(n),e.data.ref_cnv.child(e.data.user.conversation_id+"/typing/"+e.data.user.user_id).remove())}}),s&&this.data.ref_cnv.child(s+"/typing").off(),this.data.ref_cnv.child(this.data.user.conversation_id+"/typing").on("value",function(s){var i=0,n=s.val(),a=n?Object.keys(n).length:0;return n?void t.each(n,function(t,s){return null!=t&&t!=e.data.user.user_id?void e.display_ntf(e.strings.msg.writing.replace(/%s/i,s),"typing"):(a===i&&e.clean_ntf(),void(i+=1))}):void e.clean_ntf()}),this.objs.popup.find(".chat-cnv-reply").click(function(){n.focus()})},reload_cnv:function(s){this.data.ref_msgs.once("value",function(e){var i=(new Date,e.val()),n=(i?Object.keys(i).length:0,0);i&&t.each(i,function(t,e){e.conversation_id==s&&(e.old_msg=!0,n+=1)})})},push_msg:function(t){this.data.ref_msgs.push({user_id:this.data.user.user_id,user_type:this.data.user.user_type,conversation_id:this.data.user.conversation_id,user_name:this.data.user.user_name||this.data.user.user_email,gravatar:this.data.user.gravatar,avatar_type:this.data.user.avatar_type,avatar_image:this.data.user.avatar_image,msg:t,msg_time:Firebase.ServerValue.TIMESTAMP,vendor_id:ylc.active_vendor.vendor_id,read:!1})},get_template:function(t,s){var e;switch(t){case"chat-popup":e=ylc.templates.chat_popup;break;case"chat-connecting":e=ylc.templates.chat_connecting;break;case"chat-btn":e=ylc.templates.chat_btn;break;case"chat-offline":e=ylc.templates.chat_offline;break;case"chat-login":e=ylc.templates.chat_login;break;case"chat-conversation":e=ylc.templates.chat_conversation;break;case"chat-line":e=ylc.templates.chat_line;break;case"chat-offline-form-premium":e=ylc.templates.premium.chat_offline_form_premium;break;case"chat-evaluation-premium":e=ylc.templates.premium.chat_evaluation_premium;break;case"chat-transcript-premium":e=ylc.templates.premium.chat_transcript_premium;break;case"chat-transcript-btn-premium":e=ylc.templates.premium.chat_transcript_btn_premium;break;default:e=""}return this.string_replace(e,s)},string_replace:function(t,s){for(var e in s)if(s.hasOwnProperty(e)){var i=new RegExp("ylc."+e,"gm");t=t.replace(i,s[e])}return t},get_user_data:function(t,s){this.data.ref_users.child(t).once("value",function(t){var e=t.val();s(e)})},render_btn:function(){var s=this;this.data.primary_fg=this.use_white(this.opts.styles.bg_color)?"#ffffff":"#444444",this.data.primary_hover=this.shade_color(this.opts.styles.bg_color,7),this.el.html(this.get_template("chat-btn",{title:this.strings.msg.chat_title,styles:ylc.is_premium?this.trigger_premium("stylize","chat_button"):"",arrow:"bottom"==this.opts.styles.y_pos?"up":"down"})),this.objs.btn=t("#YLC_chat_btn"),this.objs.btn.hover(function(){t(this).css("background-color",s.data.primary_hover)},function(){t(this).css("background-color",s.opts.styles.bg_color)}),this.objs.btn.click(function(){var e=t(this),i=t(this).find(".chat-title");i.html(s.strings.msg.please_wait+"..."),e.hide(),s.show_popup(),s.auth(function(){i.html(s.strings.msg.chat_title)})}),setTimeout(function(){s.show_btn()},this.data.show_delay)},render_popup:function(){var i=this;this.el.append(this.get_template("chat-popup",{title:this.strings.msg.connecting+"...",header_styles:ylc.is_premium?this.trigger_premium("stylize","chat_header"):"",widget_styles:ylc.is_premium?this.trigger_premium("stylize","chat_widget"):"",arrow:"bottom"==this.opts.styles.y_pos?"down":"up",body_class:"chat-form",body:this.get_template("chat-connecting",{lead:this.strings.msg.connecting+"..."})})),this.objs.popup=t("#YLC_chat"),this.objs.popup_header=t("#YLC_chat_header"),this.objs.popup_body=t("#YLC_chat_body"),"bottom"!==this.opts.styles.y_pos&&this.objs.popup_body.attr("style",ylc.is_premium?this.trigger_premium("stylize","chat_body"):""),this.objs.popup_body.css("width",this.opts.styles.form_width+"px"),t(e).on("hover","#YLC_send_btn",function(){t(this).css("background-color",i.data.primary_hover)},function(){t(this).css("background-color",i.opts.styles.bg_color)}),t(s).resize(function(){var t=s,n=e,a=n.documentElement,r=n.getElementsByTagName("body")[0],o=(t.innerWidth||a.clientWidth||r.clientWidth,t.innerHeight||a.clientHeight||r.clientHeight),l=i.objs.popup_header.height(),c=parseInt(i.objs.popup.css("bottom"),10),_="online"===i.data.mode?320:450,h=o>_+l?_:o-l-c;i.objs.popup_body.css("max-height",h),ylc.is_premium&&i.trigger_premium("resize_chat")}).trigger("resize")},show_popup:function(){if("open"!=this.data.popup_status){var s=this;this.objs.popup.show(),this.animate(this.objs.popup,this.opts.styles.animation_type),setTimeout(function(){s.objs.popup_header.click(function(){s.be_offline(),s.minimize(),s.objs.popup_header.off("click")})},3e3),setTimeout(function(){switch(s.data.mode){case"online":t("#YLC_cnv_reply").focus(),s.objs.cnv.scrollTop(s.objs.cnv.prop("scrollHeight"));break;case"offline":case"login":t("#YLC_popup_form .chat-line:first-child input").focus()}s.data.popup_status="open"},this.data.animation_delay)}},show_btn:function(t){this.allow_chatbox()&&(this.objs.btn.show(),this.objs.btn.find(".chat-title").html(t),this.animate(this.objs.btn,this.opts.styles.animation_type))},minimize:function(){this.data.popup_status="close",this.objs.popup&&this.objs.popup.hide(),this.objs.btn.show(),this.animate(this.objs.btn,this.opts.styles.animation_type)},manage_connections:function(){var t=this;this.data.ref_user&&this.data.ref_conn.on("value",function(s){if(s.val()===!0){var e=t.data.ref_user.child("connections").push(!0);e.onDisconnect().remove(),t.data.ref_user.child("status").set("online"),t.data.ref_user.child("status").onDisconnect().set("offline"),t.data.ref_user.child("last_online").onDisconnect().set(Firebase.ServerValue.TIMESTAMP),t.data.ref_cnv.child(t.data.user.conversation_id+"/typing/"+t.data.user.user_id).onDisconnect().remove()}else t.show_offline()})},post:function(s,e,i,n){t.post(ylc.ajax_url+"?action="+s+"&mode="+e,i,n,"json").fail(function(t){return console.log(e,": ",t),!1})},trigger_premium:function(t,s,e,i,n,a,r){return this.premium[t].call(this,s,e,i,n,a,r)},display_ntf:function(s,e){var i;switch(e){case"success":i='<i class="fa fa-check"></i> ';break;case"error":i='<i class="fa fa-exclamation-triangle"></i> ';break;case"typing":i='<i class="fa fa-pencil-square-o"></i> ';break;default:i=""}t("#YLC_popup_ntf").removeClass().addClass("chat-ntf chat-"+e).html(i+s).fadeIn(300)},clean_ntf:function(){t("#YLC_popup_ntf").html("").hide()},clear_user_data:function(s,e){var i=this;this.data.ref_cnv.child(s).once("value",function(n){var a=n.val();if(a){var r=a.user_id;i.data.ref_msgs.once("value",function(n){var a=n.val(),o=a?Object.keys(a).length:0,l=0;a?t.each(a,function(t,n){l+=1,n.conversation_id===s&&i.data.ref_msgs.child(t).remove(),o===l&&e&&e()}):e&&e(),i.data.ref_users.child(r).remove(),i.data.ref_cnv.child(s).remove()})}})},total_online_ops:function(){return this.data.online_ops?Object.keys(this.data.online_ops).length:0},allow_chatbox:function(){return this.opts.render?!0:!1},animate:function(e,i){t(s).trigger("resize");var n="top"===this.opts.styles.y_pos?"Down":"Up";e.addClass("chat-anim chat-"+i+n),setTimeout(function(){e.removeClass("chat-anim chat-"+i+n)},this.data.animation_delay)},shade_color:function(t,s){var e=parseInt(t.slice(1),16),i=Math.round(2.55*s),n=(e>>16)+i,a=(e>>8&255)+i,r=(255&e)+i;return"#"+(16777216+65536*(255>n?1>n?0:n:255)+256*(255>a?1>a?0:a:255)+(255>r?1>r?0:r:255)).toString(16).slice(1)},use_white:function(t){var t=t.substring(1),s=parseInt(t,16),e=s>>16&255,i=s>>8&255,n=s>>0&255,a=.2126*e+.7152*i+.0722*n;return 180>a?!0:!1},validate_email:function(t){var s=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return s.test(t)},validate_username:function(t){var s=/^[\u0030-\u0039\u0041-\u005A\u0061-\u007A\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u00FF\u0100-\u017F\u0180-\u024F\u0370-\u03FF\u0400-\u04FF\u0530-\u058F\u0590-\u05FF\u0600-\u06FF\u0020\u002D\u002E\u0040\u005F]+$/gim;return s.test(t)},md5:function(t){function s(t,s){var e,i,n,a,r;return n=2147483648&t,a=2147483648&s,e=1073741824&t,i=1073741824&s,r=(1073741823&t)+(1073741823&s),e&i?2147483648^r^n^a:e|i?1073741824&r?3221225472^r^n^a:1073741824^r^n^a:r^n^a}function e(t,e,i,n,a,r,o){return t=s(t,s(s(e&i|~e&n,a),o)),s(t<<r|t>>>32-r,e)}function i(t,e,i,n,a,r,o){return t=s(t,s(s(e&n|i&~n,a),o)),s(t<<r|t>>>32-r,e)}function n(t,e,i,n,a,r,o){return t=s(t,s(s(e^i^n,a),o)),s(t<<r|t>>>32-r,e)}function a(t,e,i,n,a,r,o){return t=s(t,s(s(i^(e|~n),a),o)),s(t<<r|t>>>32-r,e)}function r(t){var s,e="",i="";for(s=0;3>=s;s++)i=t>>>8*s&255,i="0"+i.toString(16),e+=i.substr(i.length-2,2);return e}var o,l,c,_,h,u,d,m,p=[];for(t=function(t){t=t.replace(/\r\n/g,"\n");for(var s="",e=0;e<t.length;e++){var i=t.charCodeAt(e);128>i?s+=String.fromCharCode(i):(i>127&&2048>i?s+=String.fromCharCode(i>>6|192):(s+=String.fromCharCode(i>>12|224),s+=String.fromCharCode(i>>6&63|128)),s+=String.fromCharCode(63&i|128))}return s}(t),p=function(t){var s,e=t.length;s=e+8;for(var i=16*((s-s%64)/64+1),n=Array(i-1),a=0,r=0;e>r;)s=(r-r%4)/4,a=r%4*8,n[s]|=t.charCodeAt(r)<<a,r++;return s=(r-r%4)/4,n[s]|=128<<r%4*8,n[i-2]=e<<3,n[i-1]=e>>>29,n}(t),h=1732584193,u=4023233417,d=2562383102,m=271733878,t=0;t<p.length;t+=16)o=h,l=u,c=d,_=m,h=e(h,u,d,m,p[t+0],7,3614090360),m=e(m,h,u,d,p[t+1],12,3905402710),d=e(d,m,h,u,p[t+2],17,606105819),u=e(u,d,m,h,p[t+3],22,3250441966),h=e(h,u,d,m,p[t+4],7,4118548399),m=e(m,h,u,d,p[t+5],12,1200080426),d=e(d,m,h,u,p[t+6],17,2821735955),u=e(u,d,m,h,p[t+7],22,4249261313),h=e(h,u,d,m,p[t+8],7,1770035416),m=e(m,h,u,d,p[t+9],12,2336552879),d=e(d,m,h,u,p[t+10],17,4294925233),u=e(u,d,m,h,p[t+11],22,2304563134),h=e(h,u,d,m,p[t+12],7,1804603682),m=e(m,h,u,d,p[t+13],12,4254626195),d=e(d,m,h,u,p[t+14],17,2792965006),u=e(u,d,m,h,p[t+15],22,1236535329),h=i(h,u,d,m,p[t+1],5,4129170786),m=i(m,h,u,d,p[t+6],9,3225465664),d=i(d,m,h,u,p[t+11],14,643717713),u=i(u,d,m,h,p[t+0],20,3921069994),h=i(h,u,d,m,p[t+5],5,3593408605),m=i(m,h,u,d,p[t+10],9,38016083),d=i(d,m,h,u,p[t+15],14,3634488961),u=i(u,d,m,h,p[t+4],20,3889429448),h=i(h,u,d,m,p[t+9],5,568446438),m=i(m,h,u,d,p[t+14],9,3275163606),d=i(d,m,h,u,p[t+3],14,4107603335),u=i(u,d,m,h,p[t+8],20,1163531501),h=i(h,u,d,m,p[t+13],5,2850285829),m=i(m,h,u,d,p[t+2],9,4243563512),d=i(d,m,h,u,p[t+7],14,1735328473),u=i(u,d,m,h,p[t+12],20,2368359562),h=n(h,u,d,m,p[t+5],4,4294588738),m=n(m,h,u,d,p[t+8],11,2272392833),d=n(d,m,h,u,p[t+11],16,1839030562),u=n(u,d,m,h,p[t+14],23,4259657740),h=n(h,u,d,m,p[t+1],4,2763975236),m=n(m,h,u,d,p[t+4],11,1272893353),d=n(d,m,h,u,p[t+7],16,4139469664),u=n(u,d,m,h,p[t+10],23,3200236656),h=n(h,u,d,m,p[t+13],4,681279174),m=n(m,h,u,d,p[t+0],11,3936430074),d=n(d,m,h,u,p[t+3],16,3572445317),u=n(u,d,m,h,p[t+6],23,76029189),h=n(h,u,d,m,p[t+9],4,3654602809),m=n(m,h,u,d,p[t+12],11,3873151461),d=n(d,m,h,u,p[t+15],16,530742520),u=n(u,d,m,h,p[t+2],23,3299628645),h=a(h,u,d,m,p[t+0],6,4096336452),m=a(m,h,u,d,p[t+7],10,1126891415),d=a(d,m,h,u,p[t+14],15,2878612391),u=a(u,d,m,h,p[t+5],21,4237533241),h=a(h,u,d,m,p[t+12],6,1700485571),m=a(m,h,u,d,p[t+3],10,2399980690),d=a(d,m,h,u,p[t+10],15,4293915773),u=a(u,d,m,h,p[t+1],21,2240044497),h=a(h,u,d,m,p[t+8],6,1873313359),m=a(m,h,u,d,p[t+15],10,4264355552),d=a(d,m,h,u,p[t+6],15,2734768916),u=a(u,d,m,h,p[t+13],21,1309151649),h=a(h,u,d,m,p[t+4],6,4149444226),m=a(m,h,u,d,p[t+11],10,3174756917),d=a(d,m,h,u,p[t+2],15,718787259),u=a(u,d,m,h,p[t+9],21,3951481745),h=s(h,o),u=s(u,l),d=s(d,c),m=s(m,_);return(r(h)+r(u)+r(d)+r(m)).toLowerCase()},random_id:function(t,s){return Math.floor(Math.random()*(s-t+1))+t},valid_operator:function(t){return ylc.yith_wpv_active?ylc.yith_wpv_active&&ylc.active_vendor.vendor_id===t?!0:ylc.yith_wpv_active&&"0"===t&&!ylc.vendor_only_chat?!0:!1:!0}},t.fn[a]=function(s,e){var i,o;if(this.data(r)instanceof n||this.data(r,new n(this)),o=this.data(r),o.el=this,"undefined"==typeof s||"object"==typeof s)"function"==typeof o.init&&o.init(s,e);else{if("string"==typeof s&&"function"==typeof o[s])return i=Array.prototype.slice.call(arguments,1),o[s].apply(o,i);t.error("Method "+s+" does not exist on jQuery."+a)}}}(jQuery,window,document);